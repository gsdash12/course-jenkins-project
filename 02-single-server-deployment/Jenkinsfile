pipeline {
   agent any
   environment {
      Server_IP = credentials('prod_server_ip')
   }
   stages{
      stage('Checkout') {
         steps{
            git url: "https://github.com/gsdash12/course-jenkins-project.git", branch: 'main'
            sh 'ls -ltr'
         }
      }
      stage('Setup') {
         steps{
            dir('02-single-server-deployment') {
               sh '''
                   python3 -m venv venv
                  . venv/bin/activate
                  ./venv/bin/pip install --upgrade pip
                  ./venv/bin/pip install -r requirements.txt
               '''
            }   
         }
      }
      stage('Tets') {
         steps{
            dir('02-single-server-deployment') {
               sh '''
                   . venv/bin/activate
                   .venv/bin/python -m pytest
               '''
            }    
         }
      }
      stage('Package Code') {
         steps{
            sh "zip -r myapp.zip ./* -x '**.git**'"
            sh 'ls -lart'
         }
      }
      stage('Deployment') {
         steps{
            echo 'hello world'
         }

      }
   }
}
